{"version":3,"sources":["index.min.js"],"names":["global","factory","exports","module","define","amd","JC","this","Flower","options","_this","Sprite","call","alive","texture","loaded","_center","on","Flowers","assetsMap","doc","Container","defaultBegin","begin","defaultEnd","end","Flowflower","stageOpts","Utils","merge","STAGE_OPTION","stage","flowersOpts","flowers","loaderUtil","assets","init","inModule","require","inBrowser","window","prototype","Object","create","randomInArea","_ref","x","y","width","height","Point","random","pivotX","pivotY","fall","This","visible","alpha","p0","p3","v","subVectors","p1","clone","add","multiplyScalar","p2","time","duration","wait","runners","from","scale","to","ease","Tween","Ease","In","Out","motion","path","BezierCurve","master","branch","key","undefined","STORE","aliveFlowers","idelFlowers","_checkAlive","idel","type","alivePool","idelPool","i","length","push","splice","_getFlowers","flux","ffs","_shipFlowers","flowerSeed","flowerGerm","getById","idels","num","f","adds","falling","ft","dom","interactive","enableFPS","Stage","fallFlowers","cb","setTimeout","start","startEngine","stop","stopEngine","defineProperty","value"],"mappings":"CAAC,SAAUA,EAAQC,GACE,iBAAZC,SAA0C,oBAAXC,OAAyBF,EAAQC,SACrD,mBAAXE,QAAyBA,OAAOC,IAAMD,QAAQ,WAAYH,GAChEA,EAASD,EAAOM,GAAKN,EAAOM,QAH/B,CAIEC,KAAM,SAAWL,GAAW,aAa9B,SAASM,EAAOC,GACd,IAAIC,EAAQH,KAEZD,EAAGK,OAAOC,KAAKL,KAAME,GACrBF,KAAKM,OAAQ,EACTN,KAAKO,QAAQC,OACfR,KAAKS,UAELT,KAAKO,QAAQG,GAAG,OAAQ,WACtBP,EAAMM,YAiGZ,SAASE,EAAQT,GACfF,KAAKY,UAAYV,EAAQU,UACzBZ,KAAKa,IAAM,IAAId,EAAGe,UAClBd,KAAKe,aAAeb,EAAQc,MAC5BhB,KAAKiB,WAAaf,EAAQgB,IAiF5B,SAASC,EAAWjB,GAClBF,KAAKoB,UAAYC,EAAMC,MAAMC,EAAcrB,EAAQsB,OACnDxB,KAAKyB,YAAcvB,EAAQwB,QAC3B1B,KAAKyB,YAAYb,UAAYb,EAAG4B,WAAW3B,KAAKyB,YAAYG,QAC5D5B,KAAK6B,OA9MP,IAAIC,EAA8B,mBAAZC,QAClBC,EAA8B,oBAAXC,OACnBlC,EAAK+B,GAAYE,EAAYD,QAAQ,8BAAgCC,EAAYC,OAAOlC,OAuB5FE,EAAOiC,UAAYC,OAAOC,OAAOrC,EAAGK,OAAO8B,YAE1BG,aAAe,SAAUC,GACxC,IAAIC,EAAID,EAAKC,EACTC,EAAIF,EAAKE,EACTC,EAAQH,EAAKG,MACbC,EAASJ,EAAKI,OAElB,OAAO,IAAI3C,EAAG4C,MAAM5C,EAAGsB,MAAMuB,OAAOL,EAAGA,EAAIE,GAAQ1C,EAAGsB,MAAMuB,OAAOJ,EAAGA,EAAIE,KAG5EzC,EAAOiC,UAAUzB,QAAU,WACzBT,KAAK6C,OAAS7C,KAAKyC,OAAS,EAC5BzC,KAAK8C,OAAS9C,KAAK0C,QAAU,GAG/BzC,EAAOiC,UAAUa,KAAO,SAAU7C,GAChC,IAAI8C,EAAOhD,KACXA,KAAKM,OAAQ,EACbN,KAAKiD,SAAU,EACfjD,KAAKkD,MAAQ,EAEb,IAAIC,EAAKnD,KAAKqC,aAAanC,EAAQc,OAC/BoC,EAAKpD,KAAKqC,aAAanC,EAAQgB,KACnCkC,EAAGb,EAAIxC,EAAGsB,MAAMuB,OAAOO,EAAGZ,EAAI,IAAKY,EAAGZ,EAAI,KAE1C,IAAIc,GAAI,IAAItD,EAAG4C,OAAQW,WAAWF,EAAID,GAElCI,EAAKJ,EAAGK,QAAQC,IAAIJ,EAAEG,QAAQE,eAAe,EAAI,IACjDC,EAAKR,EAAGK,QAAQC,IAAIJ,EAAEG,QAAQE,eAAe,EAAI,IAErDH,EAAGhB,EAAIxC,EAAGsB,MAAMuB,OAAOW,EAAGhB,EAAI,IAAKgB,EAAGhB,EAAI,KAC1CoB,EAAGpB,EAAIxC,EAAGsB,MAAMuB,OAAOe,EAAGpB,EAAI,IAAKoB,EAAGpB,EAAI,KAE1C,IAAIqB,EAAO1D,EAAQ0D,KACfC,EAAW9D,EAAGsB,MAAMuB,OAAOgB,EAAO,EAAGA,GACrCE,EAAO/D,EAAGsB,MAAMuB,OAAO,EAAG,KAC9B5C,KAAK+D,SACHA,UACEC,MAAQC,MAAO,GAAKf,MAAO,GAC3BgB,IAAMD,MAAOlE,EAAGsB,MAAMuB,OAAO,GAAK,KAAMM,MAAO,GAC/CW,SAAqB,IAAXA,EACVM,KAAMpE,EAAGqE,MAAMC,KAAKC,KAEpBJ,IAAMD,MAAOlE,EAAGsB,MAAMuB,OAAO,GAAK,IAClCiB,SAAqB,GAAXA,IAEVK,IAAMD,MAAO,GAAKf,MAAO,GACzBW,SAAqB,IAAXA,EACVM,KAAMpE,EAAGqE,MAAMC,KAAKE,MAEtBT,KAAMA,IACLpD,GAAG,YAAa,WACjBsC,EAAKC,SAAU,EACfD,EAAK1C,OAAQ,IAEfN,KAAKwE,QACHC,KAAM,IAAI1E,EAAG2E,aAAavB,EAAII,EAAII,EAAIP,IACtCS,SAAUA,EACVC,KAAMA,EACNK,KAAMpE,EAAGqE,MAAMC,KAAKC,MASxB,IAAIjD,GACFC,MAAO,SAAeqD,EAAQC,GAC5B,IAAKA,EAAQ,OAAOD,EACpB,IAAK,IAAIE,KAAOD,OACME,IAAhBF,EAAOC,KACTF,EAAOE,GAAOD,EAAOC,IAGzB,OAAOF,IAMPI,GACFC,gBACAC,gBAcFtE,EAAQuB,UAAUgD,YAAc,SAAU5E,EAAO6E,GAC/C,IAAK,IAAIC,KAAQ9E,EAIf,IAHA,IAAI+E,EAAY/E,EAAM8E,OAClBE,EAAWH,EAAKC,OAChBG,EAAIF,EAAUG,OAAS,EACpBD,GAAK,GACGF,EAAUE,GACXjF,OACVgF,EAASG,KAAKJ,EAAUK,OAAOH,EAAG,GAAG,IAEvCA,KAKN5E,EAAQuB,UAAUyD,YAAc,SAAUjE,EAASkE,GAEjD,IADA,IAAIC,KACGD,MAAU,GAAG,CAClB,IAAIR,EAAOrF,EAAGsB,MAAMuB,OAAOlB,GAC3BmE,EAAIT,GAAQS,EAAIT,IAAS,EACzBS,EAAIT,KAEN,OAAOS,GAGTlF,EAAQuB,UAAU4D,aAAe,SAAU5F,GACzCF,KAAKkF,YAAYH,EAAMC,aAAcD,EAAME,aAC3C,IAAIc,EAAa/F,KAAK2F,YAAYzF,EAAQwB,QAASxB,EAAQ0F,MACvDI,KACJ,IAAK,IAAIZ,KAAQW,EAAY,CAC3B,IAAIxF,EAAUP,KAAKY,UAAUqF,QAAQb,GACjCS,EAAME,EAAWX,GACjBc,EAAQnB,EAAME,YAAYG,OAC1Be,EAAMN,EAAMK,EAAMV,OACtB,GAAIW,EAAM,EACR,IAAK,IAAIZ,EAAI,EAAGA,EAAIY,EAAKZ,IAAK,CAC5B,IAAIa,EAAI,IAAInG,GACVM,QAASA,IAEXP,KAAKa,IAAIwF,KAAKD,GACdF,EAAMT,KAAKW,GAGfJ,EAAWZ,GAAQc,EAAMR,OAAO,EAAGG,GAErC,OAAOG,GAGTrF,EAAQuB,UAAUoE,QAAU,SAAUpG,GACpC,IAAIc,EAAQK,EAAMC,MAAMtB,KAAKe,aAAcb,EAAQc,OAC/CE,EAAMG,EAAMC,MAAMtB,KAAKiB,WAAYf,EAAQgB,KAC3C0C,EAAO1D,EAAQ0D,KACfoC,EAAahG,KAAK8F,aAAa5F,GACnC,IAAK,IAAIkF,KAAQY,EAEf,IAAK,IADDO,EAAKP,EAAWZ,GACXG,EAAI,EAAGA,EAAIgB,EAAGf,OAAQD,IAChBgB,EAAGhB,GACTxC,MACL/B,MAAOA,EACPE,IAAKA,EACL0C,KAAMA,KAMd,IAAIrC,GACFiF,IAAK,mBACLC,aAAa,EACbC,WAAW,EACXjE,MAAO,IACPC,OAAQ,KAcVvB,EAAWe,UAAUL,KAAO,WAC1B7B,KAAKwB,MAAQ,IAAIzB,EAAG4G,MAAM3G,KAAKoB,WAC/BpB,KAAK0B,QAAU,IAAIf,EAAQX,KAAKyB,aAChCzB,KAAKwB,MAAM6E,KAAKrG,KAAK0B,QAAQb,MAG/BM,EAAWe,UAAU0E,YAAc,SAAU1G,EAAS2G,GACpD3G,EAAQ0D,KAAO1D,EAAQ0D,MAAQ,KAC/B5D,KAAK0B,QAAQ4E,QAAQpG,GACrB2G,GAAMC,WAAWD,EAAI3G,EAAQ0D,OAG/BzC,EAAWe,UAAU6E,MAAQ,WAC3B/G,KAAKwB,MAAMwF,eAGb7F,EAAWe,UAAU+E,KAAO,WAC1BjH,KAAKwB,MAAM0F,cAGbvH,EAAQI,GAAKA,EACbJ,EAAQwB,WAAaA,EAErBgB,OAAOgF,eAAexH,EAAS,cAAgByH,OAAO","file":"index.min.js","sourcesContent":["(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n  typeof define === 'function' && define.amd ? define(['exports'], factory) :\n  (factory((global.JC = global.JC || {})));\n}(this, (function (exports) { 'use strict';\n\nvar inModule = typeof require === 'function';\nvar inBrowser = typeof window !== 'undefined';\nvar JC = inModule && inBrowser ? require('jcc2d/build/jcc2d.light.js') : inBrowser ? window.JC : {};\n\n/* eslint no-bitwise: 0 */\n/* eslint max-len: 0 */\n\n/**\n *\n * @param {Object} options\n */\nfunction Flower(options) {\n  var _this = this;\n\n  JC.Sprite.call(this, options);\n  this.alive = false;\n  if (this.texture.loaded) {\n    this._center();\n  } else {\n    this.texture.on('load', function () {\n      _this._center();\n    });\n  }\n}\n\nFlower.prototype = Object.create(JC.Sprite.prototype);\n\nFlower.prototype.randomInArea = function (_ref) {\n  var x = _ref.x,\n      y = _ref.y,\n      width = _ref.width,\n      height = _ref.height;\n\n  return new JC.Point(JC.Utils.random(x, x + width), JC.Utils.random(y, y + height));\n};\n\nFlower.prototype._center = function () {\n  this.pivotX = this.width >> 1;\n  this.pivotY = this.height >> 1;\n};\n\nFlower.prototype.fall = function (options) {\n  var This = this;\n  this.alive = true;\n  this.visible = true;\n  this.alpha = 0;\n\n  var p0 = this.randomInArea(options.begin);\n  var p3 = this.randomInArea(options.end);\n  p3.x = JC.Utils.random(p0.x - 150, p0.x + 150);\n\n  var v = new JC.Point().subVectors(p3, p0);\n\n  var p1 = p0.clone().add(v.clone().multiplyScalar(1 / 3));\n  var p2 = p0.clone().add(v.clone().multiplyScalar(2 / 3));\n\n  p1.x = JC.Utils.random(p1.x - 120, p1.x + 120);\n  p2.x = JC.Utils.random(p2.x - 120, p2.x + 120);\n\n  var time = options.time;\n  var duration = JC.Utils.random(time / 2, time);\n  var wait = JC.Utils.random(0, 300);\n  this.runners({\n    runners: [{\n      from: { scale: 0.3, alpha: 0 },\n      to: { scale: JC.Utils.random(0.8, 1.4), alpha: 1 },\n      duration: duration * 0.05,\n      ease: JC.Tween.Ease.In\n    }, {\n      to: { scale: JC.Utils.random(0.9, 1) },\n      duration: duration * 0.9\n    }, {\n      to: { scale: 0.3, alpha: 0 },\n      duration: duration * 0.05,\n      ease: JC.Tween.Ease.Out\n    }],\n    wait: wait\n  }).on('compelete', function () {\n    This.visible = false;\n    This.alive = false;\n  });\n  this.motion({\n    path: new JC.BezierCurve([p0, p1, p2, p3]),\n    duration: duration,\n    wait: wait,\n    ease: JC.Tween.Ease.In\n  });\n};\n\n/**\n * Utils 工具箱\n *\n * @namespace JC.Utils\n */\nvar Utils = {\n  merge: function merge(master, branch) {\n    if (!branch) return master;\n    for (var key in branch) {\n      if (branch[key] !== undefined) {\n        master[key] = branch[key];\n      }\n    }\n    return master;\n  }\n};\n\n/* eslint guard-for-in: 0 */\n\nvar STORE = {\n  aliveFlowers: {},\n  idelFlowers: {}\n};\n\n/**\n *\n * @param {Object} options\n */\nfunction Flowers(options) {\n  this.assetsMap = options.assetsMap;\n  this.doc = new JC.Container();\n  this.defaultBegin = options.begin;\n  this.defaultEnd = options.end;\n}\n\nFlowers.prototype._checkAlive = function (alive, idel) {\n  for (var type in alive) {\n    var alivePool = alive[type] || [];\n    var idelPool = idel[type] || [];\n    var i = alivePool.length - 1;\n    while (i >= 0) {\n      var flower = alivePool[i];\n      if (!flower.alive) {\n        idelPool.push(alivePool.splice(i, 1)[0]);\n      }\n      i--;\n    }\n  }\n};\n\nFlowers.prototype._getFlowers = function (flowers, flux) {\n  var ffs = {};\n  while (flux-- >= 0) {\n    var type = JC.Utils.random(flowers);\n    ffs[type] = ffs[type] || 0;\n    ffs[type]++;\n  }\n  return ffs;\n};\n\nFlowers.prototype._shipFlowers = function (options) {\n  this._checkAlive(STORE.aliveFlowers, STORE.idelFlowers);\n  var flowerSeed = this._getFlowers(options.flowers, options.flux);\n  var flowerGerm = {};\n  for (var type in flowerSeed) {\n    var texture = this.assetsMap.getById(type);\n    var ffs = flowerSeed[type];\n    var idels = STORE.idelFlowers[type] || [];\n    var num = ffs - idels.length;\n    if (num > 0) {\n      for (var i = 0; i < num; i++) {\n        var f = new Flower({\n          texture: texture\n        });\n        this.doc.adds(f);\n        idels.push(f);\n      }\n    }\n    flowerGerm[type] = idels.splice(0, ffs);\n  }\n  return flowerGerm;\n};\n\nFlowers.prototype.falling = function (options) {\n  var begin = Utils.merge(this.defaultBegin, options.begin);\n  var end = Utils.merge(this.defaultEnd, options.end);\n  var time = options.time;\n  var flowerGerm = this._shipFlowers(options);\n  for (var type in flowerGerm) {\n    var ft = flowerGerm[type];\n    for (var i = 0; i < ft.length; i++) {\n      var flower = ft[i];\n      flower.fall({\n        begin: begin,\n        end: end,\n        time: time\n      });\n    }\n  }\n};\n\nvar STAGE_OPTION = {\n  dom: 'flowflower-stage',\n  interactive: false,\n  enableFPS: false,\n  width: 320,\n  height: 320\n};\n\n/**\n *\n * @param {Object} options\n */\nfunction Flowflower(options) {\n  this.stageOpts = Utils.merge(STAGE_OPTION, options.stage);\n  this.flowersOpts = options.flowers;\n  this.flowersOpts.assetsMap = JC.loaderUtil(this.flowersOpts.assets);\n  this.init();\n}\n\nFlowflower.prototype.init = function () {\n  this.stage = new JC.Stage(this.stageOpts);\n  this.flowers = new Flowers(this.flowersOpts);\n  this.stage.adds(this.flowers.doc);\n};\n\nFlowflower.prototype.fallFlowers = function (options, cb) {\n  options.time = options.time || 3200;\n  this.flowers.falling(options);\n  cb && setTimeout(cb, options.time);\n};\n\nFlowflower.prototype.start = function () {\n  this.stage.startEngine();\n};\n\nFlowflower.prototype.stop = function () {\n  this.stage.stopEngine();\n};\n\nexports.JC = JC;\nexports.Flowflower = Flowflower;\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\n})));\n//# sourceMappingURL=index.js.map\n"]}