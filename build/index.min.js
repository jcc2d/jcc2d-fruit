!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.JC=e.JC||{})}(this,function(e){"use strict";function t(e){var t=this;r.Sprite.call(this,e),this.alive=!1,this.texture.loaded?this._center():this.texture.on("load",function(){t._center()})}function i(e){this.assetsMap=e.assetsMap,this.doc=new r.Container,this.defaultBegin=e.begin,this.defaultEnd=e.end}function s(e){this.stageOpts=a.merge(h,e.stage),this.flowersOpts=e.flowers,this.flowersOpts.assetsMap=r.loaderUtil(this.flowersOpts.assets),this.init()}var o="function"==typeof require,n="undefined"!=typeof window,r=o&&n?require("jcc2d/build/jcc2d.light.js"):n?window.JC:{};(t.prototype=Object.create(r.Sprite.prototype)).randomInArea=function(e){var t=e.x,i=e.y,s=e.width,o=e.height;return new r.Point(r.Utils.random(t,t+s),r.Utils.random(i,i+o))},t.prototype._center=function(){this.pivotX=this.width>>1,this.pivotY=this.height>>1},t.prototype.fall=function(e){var t=this;this.alive=!0,this.visible=!0,this.alpha=0;var i=this.randomInArea(e.begin),s=this.randomInArea(e.end);s.x=r.Utils.random(i.x-150,i.x+150);var o=(new r.Point).subVectors(s,i),n=i.clone().add(o.clone().multiplyScalar(1/3)),a=i.clone().add(o.clone().multiplyScalar(2/3));n.x=r.Utils.random(n.x-120,n.x+120),a.x=r.Utils.random(a.x-120,a.x+120);var l=e.time,h=r.Utils.random(l/2,l),d=r.Utils.random(0,300);this.runners({runners:[{from:{scale:.3,alpha:0},to:{scale:r.Utils.random(.8,1.4),alpha:1},duration:.05*h,ease:r.Tween.Ease.In},{to:{scale:r.Utils.random(.9,1)},duration:.9*h},{to:{scale:.3,alpha:0},duration:.05*h,ease:r.Tween.Ease.Out}],wait:d}).on("compelete",function(){t.visible=!1,t.alive=!1}),this.motion({path:new r.BezierCurve([i,n,a,s]),duration:h,wait:d,ease:r.Tween.Ease.In})};var a={merge:function(e,t){if(!t)return e;for(var i in t)void 0!==t[i]&&(e[i]=t[i]);return e}},l={aliveFlowers:{},idelFlowers:{}};i.prototype._checkAlive=function(e,t){for(var i in e)for(var s=e[i]||[],o=t[i]||[],n=s.length-1;n>=0;)s[n].alive||o.push(s.splice(n,1)[0]),n--},i.prototype._getFlowers=function(e,t){for(var i={};t-- >=0;){var s=r.Utils.random(e);i[s]=i[s]||0,i[s]++}return i},i.prototype._shipFlowers=function(e){this._checkAlive(l.aliveFlowers,l.idelFlowers);var i=this._getFlowers(e.flowers,e.flux),s={};for(var o in i){var n=this.assetsMap.getById(o),r=i[o],a=l.idelFlowers[o]||[],h=r-a.length;if(h>0)for(var d=0;d<h;d++){var f=new t({texture:n});this.doc.adds(f),a.push(f)}s[o]=a.splice(0,r)}return s},i.prototype.falling=function(e){var t=a.merge(this.defaultBegin,e.begin),i=a.merge(this.defaultEnd,e.end),s=e.time,o=this._shipFlowers(e);for(var n in o)for(var r=o[n],l=0;l<r.length;l++)r[l].fall({begin:t,end:i,time:s})};var h={dom:"flowflower-stage",interactive:!1,enableFPS:!1,width:320,height:320};s.prototype.init=function(){this.stage=new r.Stage(this.stageOpts),this.flowers=new i(this.flowersOpts),this.stage.adds(this.flowers.doc)},s.prototype.fallFlowers=function(e,t){e.time=e.time||3200,this.flowers.falling(e),t&&setTimeout(t,e.time)},s.prototype.start=function(){this.stage.startEngine()},s.prototype.stop=function(){this.stage.stopEngine()},e.JC=r,e.Flowflower=s,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=index.min.js.map
