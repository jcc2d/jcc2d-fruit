{"version":3,"file":null,"sources":["../src/jc.js","../src/fruit.js","../src/fruitmachine.js"],"sourcesContent":["\nconst inModule = typeof require === 'function';\nconst inBrowser = typeof window !== 'undefined';\nexport const JC = inModule && inBrowser ?\nrequire('jcc2d/build/jcc2d.light.js') : inBrowser ?\nwindow.JC :\n{};\n","'use strict';\n/* eslint no-bitwise: 0 */\n\nimport {JC} from './jc';\n\n/**\n *\n * @param {object} options\n */\nfunction Fruit(options) {\n  this.doc = new JC.Container();\n  this.fruit = new JC.Sprite(options.fruit);\n  this.doc.x = options.fruit.x;\n  this.doc.y = options.fruit.y;\n\n  this.mask = new JC.Sprite(options.mask);\n  this.mask.x = options.mask.x;\n  this.mask.y = options.mask.y;\n\n  this.mask.alpha = 0;\n  this.doc.adds(this.fruit, this.mask);\n}\n\nFruit.prototype.light = function() {\n  this.mask.alpha = 1;\n};\n\nFruit.prototype.lightoff = function(duration) {\n  if (this.offing) return;\n  const This = this;\n  this.offing = true;\n  this.mask.animate({\n    from: {alpha: 1},\n    to: {alpha: 1},\n    duration,\n  }, true).on('complete', function() {\n    This.offing = false;\n    This.mask.alpha = 0;\n  });\n};\n\nexport {Fruit};\n","'use strict';\n/* eslint no-bitwise: 0 */\n\nimport {JC} from './jc';\nimport {Fruit} from './fruit';\n// import {Utils} from './utils';\n\n/**\n *\n * @param {object} options\n */\nfunction FruitMachine(options) {\n  this.images = options.images;\n  this.assetBox = JC.loaderUtil(options.images);\n  this.mask = options.mask;\n\n  this.doc = new JC.Container();\n\n  this.cursor = 0;\n  this.round = 0;\n  this.direction = 1;\n  this.progress = 0;\n  this.step = 800;\n  this.firing = 3000;\n  this.speed = this.speedMin = 800;\n  this.speedMax = this.speed / 10;\n\n  this.fruits = [];\n\n  this.setFruits(options.fruits);\n\n  const This = this;\n  this.doc.on('pretimeline', function(snippet) {\n    This.update(snippet);\n  });\n}\n\nFruitMachine.prototype.setFruits = function(fruits) {\n  for (let i = 0; i < fruits.length; i++) {\n    const fruit = fruits[i];\n    fruit.texture = this.assetBox.getById(fruit.ref);\n    this.mask.texture = this.assetBox.getById(this.mask.ref);\n    const mask = this.mask;\n    const fruitDoc = new Fruit({\n      fruit,\n      mask,\n    });\n    this.fruits.push(fruitDoc);\n    this.doc.adds(fruitDoc.doc);\n  }\n};\n\nFruitMachine.prototype.update = function(snippet) {\n  this.progress += snippet;\n  this.step += snippet;\n  this.startUp();\n  this.checkLight();\n};\n\nFruitMachine.prototype.startUp = function() {\n  if (this.progress <= this.firing) {\n    const rate = this.progress / this.firing;\n    this.speed = this.speedMax + (1 - rate) * (this.speedMin - this.speedMax);\n  }\n};\n\nFruitMachine.prototype.checkLight = function() {\n  if (this.step >= this.speed) {\n    this.step = JC.Utils.euclideanModulo(this.step, this.speed);\n    if (this.spill()) {\n      const total = this.fruits.length;\n      this.round++;\n      this.cursor = JC.Utils.euclideanModulo(this.cursor, total);\n      // if (this.round > 2) console.log('object');\n    }\n    this.lightOne();\n    this.cursor = this.cursor + this.direction;\n  }\n};\n\nFruitMachine.prototype.spill = function() {\n  const total = this.fruits.length;\n  const bs = this.cursor <= 0 && this.direction === -1;\n  const ts = this.cursor >= total && this.direction === 1;\n  return bs || ts;\n};\n\nFruitMachine.prototype.lightOne = function() {\n  const fruit = this.fruits[this.cursor];\n  if (fruit) fruit.lightoff(this.speed * 2);\n};\n\nFruitMachine.prototype.standTo = function() {\n\n};\n\nFruitMachine.prototype.cancle = function() {\n\n};\n\nexport {FruitMachine};\n"],"names":["inModule","require","inBrowser","window","JC","Fruit","options","doc","Container","fruit","Sprite","x","y","mask","alpha","adds","prototype","light","lightoff","duration","offing","This","animate","on","FruitMachine","images","assetBox","loaderUtil","cursor","round","direction","progress","step","firing","speed","speedMin","speedMax","fruits","setFruits","snippet","update","i","length","texture","getById","ref","fruitDoc","push","startUp","checkLight","rate","Utils","euclideanModulo","spill","total","lightOne","bs","ts","standTo","cancle"],"mappings":"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"}