{"version":3,"file":null,"sources":["../src/jc.js","../src/flower.js","../src/utils.js","../src/flowers.js","../src/flowflower.js"],"sourcesContent":["\nconst inModule = typeof require === 'function';\nconst inBrowser = typeof window !== 'undefined';\nexport const JC = inModule && inBrowser ?\nrequire('jcc2d/build/jcc2d.light.js') : inBrowser ?\nwindow.JC :\n{};\n","'use strict';\n/* eslint no-bitwise: 0 */\n/* eslint max-len: 0 */\n\nimport {JC} from './jc';\n\n/**\n *\n * @param {Object} options\n */\nfunction Flower(options) {\n  JC.Sprite.call(this, options);\n  this.alive = false;\n  if (this.texture.loaded) {\n    this._center();\n  } else {\n    this.texture.on('load', () => {\n      this._center();\n    });\n  }\n}\n\nFlower.prototype = Object.create(JC.Sprite.prototype);\n\nFlower.prototype.randomInArea = function({x, y, width, height}) {\n  return new JC.Point(JC.Utils.random(x, x + width), JC.Utils.random(y, y + height));\n};\n\nFlower.prototype._center = function() {\n  this.pivotX = this.width >> 1;\n  this.pivotY = this.height >> 1;\n};\n\nFlower.prototype.fall = function(options) {\n  const This = this;\n  this.alive = true;\n  this.visible = true;\n  this.alpha = 0;\n\n  const p0 = this.randomInArea(options.begin);\n  const p3 = this.randomInArea(options.end);\n  p3.x = JC.Utils.random(p0.x - 150, p0.x + 150);\n\n  const v = new JC.Point().subVectors(p3, p0);\n\n  const p1 = p0.clone().add(v.clone().multiplyScalar(1 / 3));\n  const p2 = p0.clone().add(v.clone().multiplyScalar(2 / 3));\n\n  p1.x = JC.Utils.random(p1.x - 120, p1.x + 120);\n  p2.x = JC.Utils.random(p2.x - 120, p2.x + 120);\n\n  const time = options.time;\n  const duration = JC.Utils.random(time / 2, time);\n  const wait = JC.Utils.random(0, 300);\n  this.runners({\n    runners: [\n      {\n        from: {scale: 0.3, alpha: 0},\n        to: {scale: JC.Utils.random(0.8, 1.4), alpha: 1},\n        duration: duration * 0.05,\n        ease: JC.Tween.Ease.In,\n      },\n      {\n        to: {scale: JC.Utils.random(0.9, 1)},\n        duration: duration * 0.9,\n      },\n      {\n        to: {scale: 0.3, alpha: 0},\n        duration: duration * 0.05,\n        ease: JC.Tween.Ease.Out,\n      },\n    ],\n    wait,\n  })\n  .on('compelete', function() {\n    This.visible = false;\n    This.alive = false;\n  });\n  this.motion({\n    path: new JC.BezierCurve([p0, p1, p2, p3]),\n    duration,\n    wait,\n    ease: JC.Tween.Ease.In,\n  });\n};\n\nexport {Flower};\n","\n/**\n * Utils 工具箱\n *\n * @namespace JC.Utils\n */\nexport const Utils = {\n  merge: function(master, branch) {\n    if (!branch) return master;\n    for (const key in branch) {\n      if (branch[key] !== undefined) {\n        master[key] = branch[key];\n      }\n    }\n    return master;\n  },\n};\n","/* eslint guard-for-in: 0 */\n\nimport {Utils} from './utils';\nimport {Flower} from './flower';\nimport {JC} from './jc';\n\nconst STORE = {\n  aliveFlowers: {},\n  idelFlowers: {},\n};\n\n/**\n *\n * @param {Object} options\n */\nfunction Flowers(options) {\n  this.assetsMap = options.assetsMap;\n  this.doc = new JC.Container();\n  this.defaultBegin = options.begin;\n  this.defaultEnd = options.end;\n}\n\nFlowers.prototype._checkAlive = function(alive, idel) {\n  for (const type in alive) {\n    const alivePool = alive[type] || [];\n    const idelPool = idel[type] || [];\n    let i = alivePool.length - 1;\n    while (i >= 0) {\n      const flower = alivePool[i];\n      if (!flower.alive) {\n        idelPool.push(alivePool.splice(i, 1)[0]);\n      }\n      i--;\n    }\n  }\n};\n\nFlowers.prototype._getFlowers = function(flowers, flux) {\n  const ffs = {};\n  while (flux-- >= 0) {\n    const type = JC.Utils.random(flowers);\n    ffs[type] = ffs[type] || 0;\n    ffs[type]++;\n  }\n  return ffs;\n};\n\nFlowers.prototype._shipFlowers = function(options) {\n  this._checkAlive(STORE.aliveFlowers, STORE.idelFlowers);\n  const flowerSeed = this._getFlowers(options.flowers, options.flux);\n  const flowerGerm = {};\n  for (const type in flowerSeed) {\n    const texture = this.assetsMap.getById(type);\n    const ffs = flowerSeed[type];\n    const idels = STORE.idelFlowers[type] || [];\n    const num = ffs - idels.length;\n    if (num > 0) {\n      for (let i = 0; i < num; i++) {\n        const f = new Flower({\n          texture,\n        });\n        this.doc.adds(f);\n        idels.push(f);\n      }\n    }\n    flowerGerm[type] = idels.splice(0, ffs);\n  }\n  return flowerGerm;\n};\n\nFlowers.prototype.falling = function(options) {\n  const begin = Utils.merge(this.defaultBegin, options.begin);\n  const end = Utils.merge(this.defaultEnd, options.end);\n  const time = options.time;\n  const flowerGerm = this._shipFlowers(options);\n  for (const type in flowerGerm) {\n    const ft = flowerGerm[type];\n    for (let i = 0; i < ft.length; i++) {\n      const flower = ft[i];\n      flower.fall({\n        begin,\n        end,\n        time,\n      });\n    }\n  }\n};\n\nexport {Flowers};\n","\nimport {Utils} from './utils';\nimport {Flowers} from './flowers';\nimport {JC} from './jc';\n\nconst STAGE_OPTION = {\n  dom: 'flowflower-stage',\n  interactive: false,\n  enableFPS: false,\n  width: 320,\n  height: 320,\n};\n\n/**\n *\n * @param {Object} options\n */\nfunction Flowflower(options) {\n  this.stageOpts = Utils.merge(STAGE_OPTION, options.stage);\n  this.flowersOpts = options.flowers;\n  this.flowersOpts.assetsMap = JC.loaderUtil(this.flowersOpts.assets);\n  this.init();\n}\n\nFlowflower.prototype.init = function() {\n  this.stage = new JC.Stage(this.stageOpts);\n  this.flowers = new Flowers(this.flowersOpts);\n  this.stage.adds(this.flowers.doc);\n};\n\nFlowflower.prototype.fallFlowers = function(options, cb) {\n  options.time = options.time || 3200;\n  this.flowers.falling(options);\n  cb && setTimeout(cb, options.time);\n};\n\nFlowflower.prototype.start = function() {\n  this.stage.startEngine();\n};\n\nFlowflower.prototype.stop = function() {\n  this.stage.stopEngine();\n};\n\nexport {Flowflower};\n"],"names":["inModule","require","inBrowser","window","JC","Flower","options","Sprite","call","alive","texture","loaded","_center","on","prototype","Object","create","randomInArea","x","y","width","height","Point","Utils","random","pivotX","pivotY","fall","This","visible","alpha","p0","begin","p3","end","v","subVectors","p1","clone","add","multiplyScalar","p2","time","duration","wait","runners","scale","Tween","Ease","In","Out","motion","BezierCurve","master","branch","key","undefined","STORE","Flowers","assetsMap","doc","Container","defaultBegin","defaultEnd","_checkAlive","idel","type","alivePool","idelPool","i","length","flower","push","splice","_getFlowers","flowers","flux","ffs","_shipFlowers","aliveFlowers","idelFlowers","flowerSeed","flowerGerm","getById","idels","num","f","adds","falling","merge","ft","STAGE_OPTION","Flowflower","stageOpts","stage","flowersOpts","loaderUtil","assets","init","Stage","fallFlowers","cb","setTimeout","start","startEngine","stop","stopEngine"],"mappings":"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"}